steps:
    - id: build docker image
      name: "gcr.io/cloud-builders/docker"
      args:
          - build
          - "-t"
          - "eu.gcr.io/ysance-eatsupdata-1/EatsUpData2022:latest"
          - "-f"
          - admin_jobs/Dockerfile
          - "."

    - id: push docker image
      name: "gcr.io/cloud-builders/docker"
      args:
          - push
          - "eu.gcr.io/rni-sknow-gbl-ww-$_ENV/sknow-gcr-adminjobs-eu-$_ENV"

    - id: terraform init
      name: "terraform"
      entrypoint: "sh"
      args:
          - "-c"
          - |
              cd terraform/
              terraform init -backend-config="bucket=ysance-eatsupdata-1-gcs-terraform-backend-eu-dv" -backend-config="prefix=ysance-eatsupdata-1"

    - id: terraform apply
      name: "terraform"
      entrypoint: "sh"
      args:
          - "-c"
          - |
              cd terraform/
              terraform apply -auto-approve -var-file=variables_$_ENV.tfvars -lock=false
